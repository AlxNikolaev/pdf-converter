<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>PDF → Slides</title>
    <style>
      body { font-family: Arial, sans-serif; margin: 0; padding: 12px; }
      .container { display: flex; flex-direction: column; gap: 12px; }
      button { background: #1a73e8; color: #fff; border: none; padding: 10px 12px; border-radius: 4px; cursor: pointer; }
      button:disabled { opacity: 0.6; cursor: not-allowed; }
      .card { border: 1px solid #e0e0e0; border-radius: 8px; padding: 12px; }
      .row { display: flex; flex-direction: column; gap: 8px; }
      .muted { color: #666; font-size: 12px; }
      progress { width: 100%; }
    </style>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script crossorigin src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    <script>
      const FUNCTION_URL = 'https://convertpdftoslides-pxbni546uq-uc.a.run.app';
    </script>
  </head>
  <body>
    <div id="root"></div>

    <script type="text/babel">
      const { useState } = React;

      function readFileAsBase64(file) {
        return new Promise((resolve, reject) => {
          const reader = new FileReader();
          reader.onload = () => {
            const base64 = reader.result.split(',')[1];
            resolve(base64);
          };
          reader.onerror = reject;
          reader.readAsDataURL(file);
        });
      }
      function App() {
        const [file, setFile] = useState(null);
        const [videoLink, setVideoLink] = useState(null)
        const [loading, setLoading] = useState(false);
        const [status, setStatus] = useState('');

        async function handleUpload() {
          if (!file) return;
          try {
            setLoading(true);
            setStatus('Reading audio...');
            const base64 = await readFileAsBase64(file);

            setStatus('Uploading to backend...');
            const res = await fetch(FUNCTION_URL, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ audioBase64: base64, audioMime: file.type || 'audio/mpeg' })
            });
            if (!res.ok) throw new Error('Backend error: ' + res.status);
            const data = await res.json();
            if (!data || !Array.isArray(data.slides)) throw new Error('Invalid response');

            setStatus('Creating slides...');
            google.script.run.withSuccessHandler((msg) => {
              setStatus(String(msg));
              setLoading(false);
            }).withFailureHandler((err) => {
              setStatus('Apps Script error: ' + err);
              setLoading(false);
            }).createSlides(data);
          } catch (e) {
            setStatus('Error: ' + (e && e.message ? e.message : String(e)));
            setLoading(false);
          }
        }

        return (
          <div className="container">
            <h2>Audio → Slides</h2>
            <div className="card">
              <div className="row">
                <input
                  type="file"
                  accept="audio/*"
                  onChange={(e) => setFile(e.target.files && e.target.files[0] ? e.target.files[0] : null)}
                />
                <button disabled={!file || loading} onClick={handleUpload}>Transcribe & Insert</button>
                {loading && <progress />}
                <div className="muted">{status}</div>
              </div>
            </div>
            <div className="muted">Uses Firebase + OpenAI whisper-1 + gpt-4o-mini</div>
          </div>
        );
      }

      ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
  </body>
  </html>


